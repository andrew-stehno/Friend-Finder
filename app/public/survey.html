<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Friend Finder</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="">
</head>

<body>
    <div class="container">
        <div class="jumbotron jumbotron-fluid">
            <div class="container">
                <h1 class="display-4">Friend Finder</h1>
                <p class="lead">Lets get started!
                </p>
                <a class="btn btn-primary" href="/" role="button">Home</a>
            </div>
        </div>
        <footer class="footer">
            <div class="container">
                <p><a href="/api/friends">Members</a>
            </div>
        </footer>

        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-header">
                        Survey
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="form-group">
                                <label for="enterUsername">Username</label>
                                <input type="text" class="form-control data-input" id="user-name"
                                    aria-describedby="emailHelp" placeholder="Please enter your username.">
                            </div>
                            <div class="form-group">
                                <label for="enterPhotoURL">Photo</label>
                                <input type="text" class="form-control data-input" id="member-photo"
                                    placeholder="Please enter a photo URL.">
                            </div>
                            <div class="form-group">
                                <label for="question1">I enjoy long walks on the beach.</label>
                                <select class="form-control answer-input" id="question1">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question2">I prefer the company of people with strong personalities.</label>
                                <select class="form-control answer-input" id="question2">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question3">I enjoy being outdoors.</label>
                                <select class="form-control answer-input" id="question3">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question4">I dislike reading.</label>
                                <select class="form-control answer-input" id="question4">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question5">I don't look forward to the weekend.</label>
                                <select class="form-control answer-input" id="question5">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question6">I like avocados.</label>
                                <select class="form-control answer-input" id="question6">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question7">I enjoy traveling abroad.</label>
                                <select class="form-control answer-input" id="question7">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question8">I never use public transit.</label>
                                <select class="form-control answer-input" id="question8">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question9">I enjoy rainy days.</label>
                                <select class="form-control answer-input" id="question9">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="question10">I look forward to going to work on Mondays.</label>
                                <select class="form-control answer-input" id="question10">
                                    <option selected value="0">Choose an option</option>
                                    <option value="1">1 (Strongly disagree)</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                    <option value="4">4</option>
                                    <option value="5">5 (Strongly agree)</option>
                                </select>
                            </div>

                            <button type="button" class="btn btn-primary btn-lg btn-block"
                                id="submit">Submit</button><br>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Results-->
        <div class="modal fade" id="modal-results" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Your match!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="match-name"></div>
                        <img id="match-photo" src="" alt="match image" style="height: 240px; width: 320px;">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Invalid-->
        <div class="modal fade" id="modal-invalid" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalCenterTitle">Invalid entry!</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>Please enter valid data.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <script type="text/javascript">

        // Get values from form:================================ 
        $("#submit").on("click", function (event) {
            event.preventDefault();
            if (inputValidate()) {

                let newMember = {
                    memberName: $("#user-name").val().toLowerCase().trim(),
                    url: $("#member-photo").val().toLowerCase().trim(),
                    scores: [...$("select[id^='question']")].map(el => $(el).val().trim())
                };
                console.log(newMember);

                // Make request to server:===============================
                $.ajax({ url: "/api/friends", method: "POST", data: newMember }).then(function (data) {
                    console.log("new member added", data);
                    // Reset form after submit:==============================
                    $("#user-name").val("");
                    $("#member-photo").val("");
                    $("select[id^='question']").map((i, el) => $(el).val('0'))

                    //trigger modal after adding in  name and image src
                    $("#match-name").text(data.name);
                    $("#match-photo").attr('src', data.photo);
                    $("#modal-results").modal("toggle");
                })
            }
            else {
                $("#modal-invalid").modal("toggle");
            }
        });

        function inputValidate() {
            var valid = true;

            $(".data-input").each(function () {
                if ($(this).val() === "") {
                    valid = false;
                }
            });

            $(".answer-input").each(function () {
                if ($(this).val() === "0") {
                    valid = false;
                }
            });

            return valid;
        }

    </script>

</body>

</html>